
using UnityEngine;
using UnityEngine.EventSystems;

public class MobileJoystick : MonoBehaviour, IPointerDownHandler, IDragHandler, IPointerUpHandler
{
    [SerializeField] private RectTransform joystickBackground;
    [SerializeField] private RectTransform joystickHandle;
    [SerializeField] private float dragRadius = 50f;
    [SerializeField] private PlayerController playerController;

    private Vector2 moveInput;
    private bool isDragging = false;

    private void Awake()
    {
        if (playerController == null)
        {
            playerController = FindObjectOfType<PlayerController>();
        }
    }

    public void OnPointerDown(PointerEventData eventData)
    {
        isDragging = true;
        OnDrag(eventData);
    }

    public void OnDrag(PointerEventData eventData)
    {
        if (!isDragging) return;

        Vector2 position;
        RectTransformUtility.ScreenPointToLocalPoint(joystickBackground, eventData.position, out position);

        position = Vector2.ClampMagnitude(position, dragRadius);
        joystickHandle.anchoredPosition = position;
        moveInput = position / dragRadius;

        if (playerController != null)
        {
            playerController.SetMoveInput(moveInput);
        }
    }

    public void OnPointerUp(PointerEventData eventData)
    {
        isDragging = false;
        joystickHandle.anchoredPosition = Vector2.zero;
        moveInput = Vector2.zero;

        if (playerController != null)
        {
            playerController.SetMoveInput(Vector2.zero);
        }
    }

    public void SetPlayerController(PlayerController controller)
    {
        playerController = controller;
    }
}

